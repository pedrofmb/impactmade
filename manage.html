<!DOCTYPE html>
<html>


<head>

    <!-- Basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Manage Virtual Numbers | Impact Made Communications</title>

    <meta name="keywords" content="HTML5 Template" />
    <meta name="description" content="Porto - Responsive HTML5 Template">
    <meta name="author" content="okler.net">

    <!-- Favicon -->
    <link rel="shortcut icon" href="img/logo-icon-trans2.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="img/apple-touch-icon.png">

    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Web Fonts  -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800%7CShadows+Into+Light" rel="stylesheet" type="text/css">

    <!-- Vendor CSS -->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="vendor/simple-line-icons/css/simple-line-icons.min.css">
    <link rel="stylesheet" href="vendor/owl.carousel/assets/owl.carousel.min.css">
    <link rel="stylesheet" href="vendor/owl.carousel/assets/owl.theme.default.min.css">
    <link rel="stylesheet" href="vendor/magnific-popup/magnific-popup.min.css">

    <!-- Theme CSS -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/theme-elements.css">
    <link rel="stylesheet" href="css/theme-blog.css">
    <link rel="stylesheet" href="css/theme-shop.css">
    <link rel="stylesheet" href="css/theme-animate.css">

    <!-- Skin CSS -->
    <link rel="stylesheet" href="css/skins/default.css">

    <!-- Theme Custom CSS -->
    <link rel="stylesheet" href="css/custom.css">

    <!-- Head Libs -->
    <script src="vendor/modernizr/modernizr.min.js"></script>
    
    <script>
        window.onresize = function() {
            CalculateMainHeight();
        };
    </script>
    
</head>


<body>

    <div class="body">

        <header id="header" data-plugin-options='{"stickyEnabled": true, "stickyEnableOnBoxed": true, "stickyEnableOnMobile": true, "stickyStartAt": 57, "stickySetTop": "-57px", "stickyChangeLogo": true}'>
            <div class="header-body">
                <div class="header-container container">
                    <div class="header-row">
                        <div class="header-column">
                            <div class="header-logo">
                                <a href="#">
                                    <img alt="Porto" width="225" height="56" data-sticky-width="160" data-sticky-height="40" data-sticky-top="33" src="img/logo.png">
                                </a>
                            </div>
                        </div>
                        <div class="header-column">
                            <div class="header-row">
                                <nav class="header-nav-top">
                                    <ul class="nav nav-pills">
                                        <li>
                                            <span class="ws-nowrap" style="color: black; font-size: 20px"><i class="fa fa-phone"></i> +1 855-804-0420</span>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                            <div class="header-row">
                                <div class="header-nav">
                                    <button class="btn header-btn-collapse-nav" data-toggle="collapse" data-target=".header-nav-main">
                                        <i class="fa fa-bars"></i>
                                    </button>
                                    <div class="header-nav-main header-nav-main-effect-1 header-nav-main-sub-effect-1 collapse">
                                        <nav>
                                            <ul class="nav nav-pills" id="mainNav">
                                                <li class="">
                                                    <a class="" href="dashboard.html">
                                                        Dashboard
                                                    </a>
                                                </li>
                                                <li class="">
                                                    <a class="" href="manage.html">
                                                        My numbers
                                                    </a>
                                                </li>
                                                <!--<li class="dropdown">
                        <a class="dropdown-toggle" href="" style="background-color: #0288CC;color: white;">
                            Manage
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="variablesAdmin.html" style="background-color: #0288CC;color: white;">Variables</a></li>
                            <li><a href="variablesAssign.html">Calls</a></li>
                        </ul>
                    </li>-->
                                                <li class="">
                                                    <a class="" href="variablesAdmin.html">
                                                        Variables Admin
                                                    </a>
                                                </li>
                                                <li class="">
                                                    <a class="" href="variablesAssign.html">
                                                        Manage Calls
                                                    </a>
                                                </li>
                                                <li class="">
                                                    <a class="" href="reports.html">
                                                        Reports
                                                    </a>
                                                </li>
                                                <li class="dropdown">
                                                    <a id="userTab" class="dropdown-toggle" href="">
                                                        User 01
                                                    </a>
                                                    <ul class="dropdown-menu">
                                                        <li><a href="myaccount.html">Account</a></li>
                                                        <li><a href="calendar.html">Calendar</a></li>
                                                        <!--<li><a href="billing.html">Billing</a></li>-->
                                                        <li><a href="javascript:Logout();">Logout</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>



        <div role="main" class="main" id="mainElement">
           
            <div class="container">

                <div class="row">
                    <div class="col-md-12">
                        <div class="tabs">
                            <ul class="nav nav-tabs nav-justified">
                                <li class="active">
                                    <a href="#tab-milogica" data-toggle="tab" class="text-center">&nbsp;</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                
                                <div id="tab-milogica" class="tab-pane active">
                                    <br/>
                                    <div class="messages"></div>

                                    <div class="row center-block">
                                        <div class="form-group">
                                            <div class="col-md-4">
                                                <label>My numbers</label>
                                                <select id="virtualNumber" name="virtualNumber" class="form-control input-lg mb-md">
                                                    <option value="0">-Select-</option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <label>Type</label>
                                                <select id="Type" name="Type" class="form-control input-lg mb-md">
                                                    <option value="0">-SMS-</option>
                                                    <option value="1">-CALL-</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 right">
                                                <!-- examples -->
                                                <label style="display: none;">Examples</label>
                                                <select style="display: none;" id="Example" name="Example" class="form-control input-lg mb-md">
                                                    <option value="0">-Inactive-</option>
                                                </select>
                                                <!-- examples -->

                                                <div class="form-group">
                                                    <div class="col-md-9">
                                                        <label>Logics :</label>
                                                        <div id="contentDropDown">
                                                            <div data-value="" id="selectOptionDropDown">--Select--</div>
                                                            <div class="fa fa-get-pocket" id="iconDropDown"></div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-2 hidden" id="loaderDropDown">
                                                        <label>&nbsp;</label>
                                                        <div><span><img src="img/loading.gif" /></span></div>
                                                    </div>

                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12 ">
                                            <div id="jTreeUI1"></div>
                                        </div>
                                    </div>
                                    <hr class="tall">
                                </div>
                                <div id="tab-probarlogica" class="tab-pane">
                                    <br/>
                                    <div class="messages"></div>

                                    <div class="row center-block">
                                        <div class="form-group">
                                            <div class="col-md-4">
                                                <label>Virtual number</label>
                                                <select id="virtualNumber2" name="virtualNumber" class="form-control input-lg mb-md">
                                                    <option value="0">-Select-</option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <label>Type</label>
                                                <select id="Type2" name="Type" class="form-control input-lg mb-md">
                                                    <option value="0">-SMS-</option>
                                                    <option value="1">-Voice-</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 right">
                                                <label>Examples</label>
                                                <select id="Example2" name="Example" class="form-control input-lg mb-md">
                                                    <option value="0">-Inactive-</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row center-block">
                                        <div class="form-group">
                                            <!--<div class="col-md-4">
                                                <label>Logics : </label>
                                                <div id="contentDropDown2">
                                                    <div data-value="" id="selectOptionDropDow2n">--Select--</div>
                                                    <div class="fa fa-get-pocket" id="iconDropDown2"></div>
                                                </div>
                                            </div>-->
                                            <div class="col-md-2 hidden" id="loaderDropDown2">
                                                <label>&nbsp;</label>
                                                <div><span><img src="img/loading.gif" /></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-12 ">
                                            <div id="jTreeUI2"></div>
                                        </div>
                                    </div>
                                    <hr class="tall">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <footer id="footer" class="hidden">
            <div class="container">
                <div class="row">
                    <div class="footer-ribbon">
                        <span>Get in Touch</span>
                    </div>
                    <div class="col-md-3">
                        <div class="newsletter">
                            <h4>Newsletter</h4>
                            <p>Keep up on our always evolving product features and technology. Enter your e-mail and subscribe to our newsletter.</p>

                            <div class="alert alert-success hidden" id="newsletterSuccess">
                                <strong>Success!</strong> You've been added to our email list.
                            </div>

                            <div class="alert alert-danger hidden" id="newsletterError"></div>

                            <form id="newsletterForm" action="php/newsletter-subscribe.php" method="POST">
                                <div class="input-group">
                                    <input class="form-control" placeholder="Email Address" name="newsletterEmail" id="newsletterEmail" type="text">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" type="submit">Go!</button>
                                    </span>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <h4>Latest Tweets</h4>
                        <div id="tweet" class="twitter" data-plugin-tweets data-plugin-options='{"username": "", "count": 2}'>
                            <p>Coming soon...</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="contact-details">
                            <h4>Contact Us</h4>
                            <ul class="contact">
                                <li><p><i class="fa fa-map-marker"></i> <strong>Address:</strong> 304 Indian Trace #224 Weston, FL 33326, United States</p></li>
                                <li><p><i class="fa fa-phone"></i> <strong>Phone:</strong> +1 954-870-4665, Tool Free: +1 855-804-0420</p></li>
                                <li><p><i class="fa fa-envelope"></i> <strong>Email:</strong> <a href="mailto:mail@example.com"> info@impactmade.com</a></p></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <h4>Follow Us</h4>
                        <ul class="social-icons">
                            <li class="social-icons-facebook"><a href="https://www.facebook.com/" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></li>
                            <li class="social-icons-twitter"><a href="https://www.twitter.com/" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></li>
                            <li class="social-icons-linkedin"><a href="https://www.linkedin.com/" target="_blank" title="Linkedin"><i class="fa fa-linkedin"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-copyright">                
                <div class="container">
                    <div class="row">
                        <div class="col-md-2">
                            <a href="index.html" class="logo">
                                <img alt="Porto Website Template" class="img-responsive" src="img/logo-footer.png">
                            </a>
                        </div>
                        <div class="col-md-4">
                            <p>© Copyright 2015. All Rights Reserved.</p>
                        </div>
                        <div class="col-md-6">
                            <nav id="sub-menu">
                                <ul>
                                    <li><a href="about-us.html">About Us</a></li>
                                    <li><a href="terms.html">Terms & Conditions </a></li>
                                    <li><a href="privacy.html">Privacy Policy</a></li>
                                    <li><a href="comming-soon.html">FAQ'S</a></li>
                                    <li><a href="contact-us.html">Contact Us</a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <div id="dropDownContentValues" class="table-responsive" style="display: none;">
        <table class="table table-striped" style="font-size: 0.85em;">
            <thead>
                <tr data-toggle="tooltip" data-placement="right" title="Tooltip on right">                    
                    <th>Name</th>
                    <th>Date</th>
                    <th>Days</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>        
    </div>

    <!-- Vendor -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/theme.init.js"></script>


    <link rel="stylesheet" href="vendor/jqueryui/jquery-ui.min.css" />
    <script type="text/javascript" src="vendor/jqueryui/jquery-ui.min.js"></script>

    <link rel="stylesheet" href="css/toastr.min.css" />
    <link rel="stylesheet" href="css/bootstrap-treeview.min.css" />
    <link rel="stylesheet" href="css/bootstrap-tour.min.css" />

    <script type="text/javascript" src="js/toastr.min.js"></script>
    <script type="text/javascript" src="js/toaster_msgs.js"></script>

    <script type="text/javascript" src="js/tree-class.js"></script>
    <script type="text/javascript" src="js/structures.js"></script>
    <script type="text/javascript" src="js/structures2.js"></script>
    <script type="text/javascript" src="js/jTreeUI/Treeview.js"></script>

    <script type="text/javascript" src="js/bootstrap-tour.min.js"></script>
    <script type="text/javascript" src="js/admin.js"></script>
    <script type="text/javascript" src="js/ajaxCore.js"></script>
    <script type="text/javascript" src="js/jTreeUI/im-tree-iu.js"></script>

    <script type="text/javascript" src="js/textBoxCategoryVariable.js"></script>

<script>
   
    $(function () {
                
        $("#userTab").html("");
        $("#userTab").html(localStorage["email"]);

        var virtualNumbersArray = [];
        var sidVirtualNumber;
        var imTreeUI1;
        var logicsArray = [];

        window.openPluginModal = function(idElement, virtualNumber) {
            var getPosition = PluginFactory.PluginVariables.GetPositionCursor(idElement);
            var plugin = new PluginFactory.PluginVariables(idElement, virtualNumber);
            plugin.OpenModal(getPosition.y);
        };

        function paginar(totalPages)
        {
            var numPages = parseInt(totalPages / 2) + (totalPages % 2);

            if (numPages == 1) {
                $("#dropDownContentValues .pagination li:eq(1)").addClass("disabled");
            }

            var pageFirstElement = $("#dropDownContentValues .pagination li:eq(0)");

            $(".itemAddPag").remove();

            for (var i = numPages; i > 0 ; i--) {
                if (i == 1)
                    pageFirstElement.after("<li class='active itemAddPag'><a href='#'> " + (i) + " <span class='sr-only'>(current)</span></a></li>");
                else
                    pageFirstElement.after("<li class='itemAddPag'><a href='#'>" + (i) + "</a></li>");
            }
        }

        function crearContextMenu(selector, imTreeUI)
        {
            $.contextMenu({
                selector: selector,
                events: {
                    show: function(options) {
                        //console.log(this);
                        var $this = $(this);
                        if (!$this.hasClass("node-selected")) {
                            $this.trigger("click");
                        }
                    }
                },
                callback: function (key, options) {
                    //console.log(options);
                    switch (key) {
                    case "insert":
                        alert("Insertar template");
                        break;
                    case "edit":
                        imTreeUI.editar();
                        break;
                    case "comment":
                        imTreeUI.comentar();
                        break;
                    case "create":
                        imTreeUI.crear();
                        break;
                    case "copy":
                        imTreeUI.copiar();
                        break;
                    case "paste":
                        imTreeUI.pegar();
                        break;
                    case "delete":
                        imTreeUI.eliminar();
                        break;
                    }
                },
                items: {
                    "insert": { name: "Insert Example", icon: "insert" },
                    "sep1": "---------",
                    "create": { name: "Create", icon: "create" },
                    "edit": { name: "Edit", icon: "edit" },
                    "delete": { name: "Delete", icon: "delete" },
                    "sep2": "---------",
                    "copy": { name: "Copy", icon: "copy" },
                    "paste": { name: "Paste", icon: "paste" },
                    "sep3": "---------",
                    "comment": { name: "Comment", icon: "comment" }
                }
            });
        }

        var pagesGeneral;
        //Dropdown Content:
        window.setDropDownValue = function (idLogic, name, description, date, isDefault, updateDays) {
            window.selectedLogic = { idLogic: idLogic, name: name, description: description, date : date };
            $("#selectOptionDropDown").html(name + ' - ' + date.split("T")[0]);

            if (updateDays == undefined)
              FillTree(idLogic);
        }

        window.mostrarErrores = function (evt) {
            evt.stopPropagation();
            alert("Mostrando errores");
        };

        var weekdaysArray = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'];

        function loadLogicsUI(sidVirtualNumber, indice, updateDays)
        {
            $("#selectOptionDropDown").html("--Loading--");
            logicsArray = [];
            Services.Local.GetLogics(
                sidVirtualNumber,
                function (result) {
                    $("#selectOptionDropDown").html();

                    var table = $("#dropDownContentValues table tbody");
                    var booleanVoice = true;
                    if (indice === 0) {
                        booleanVoice = false;
                    }

                    table.html("");
                    var text;
                    var objLogic = null;
                    $.each(result, function (ix, vx) {
                        if (objLogic == null) {
                            if (booleanVoice && vx.IsVoice) {
                                objLogic = vx;
                            }
                            if (!booleanVoice && !vx.IsVoice){
                                objLogic = vx;
                            }
                        }

                        logicsArray[vx.IdLogic] = new LogicStruct(vx.IdLogic, vx.IsVoice, vx.Name, vx.Description, vx.DateCreated, vx.IsDefault);
                        if (vx.IsVoice === booleanVoice) {
                            text = vx.Description;
                            var name = vx.Name.length > 30 ? '<abbr title="' + vx.Name + '">' + vx.Name.substring(0, 30) + '...</abbr>' : vx.Name;
                            var myDate = new Date(vx.DateCreated);
                            var formatDate = [("0" + (myDate.getMonth() + 1)).substr(-2), myDate.getDate(), myDate.getFullYear()].join("-");
                            var lblChecked = vx.IsDefault ? "checked='checked'" : "";
                            var weekDays = number2DecimalWeekdays(vx.WeekDays);
                                    
                            var tpl = "";
                            //tpl += "<tr data-toogle='tooltip' data-placement='right' title='" + text + "' data-idlogic='" + vx.IdLogic + "' data-isDefault='"+ vx.IsDefault +"' onclick=\"setDropDownValue('" + vx.IdLogic + "', '" + vx.Name + "', '" + vx.Description + "', '" + vx.DateCreated + "');\">";
                            tpl += "<tr data-toogle='tooltip' data-placement='right' title='" + text + "' data-idlogic='" + vx.IdLogic + "'>";
                            tpl += "    <td>" + name + "</td>";
                            tpl += "    <td>" + formatDate + "</td>";
                            tpl += '    <td>';
                            tpl += '      <div class="btn-group btn-group-sm daysActive" role="group">';
                                     
                            //toggle-class="active"
                            var cadParseString = arrayToStringNumber(weekDays);
                            cadParseString = convertDaysInvert(cadParseString);
                            weekDays = stringToArrayNumber(cadParseString);
                                        
                            for (var i = 0; i < weekdaysArray.length; i++) {
                                var toggleClass = weekDays[i] * 1 == 1 ? 'active' : '';
                                
                                tpl += '        <button type="button" class="btn btn-default ' + toggleClass + ' ' + weekdaysArray[i].toLowerCase() + 'day"  onclick="setDayLogics(\'' + vx.IdLogic + '\', \'' + vx.Name + '\', \'' + vx.Description + '\', \'' + vx.DateCreated + '\', \'' + arrayToStringNumber(weekDays) + '\', \'' + weekdaysArray[i] + '\' , \'' + i + '\', event);">' + weekdaysArray[i] + '</button>';
                            }

                            tpl += '      </div>';
                            tpl += '  </td>';
                                        
                            tpl += "    <td class='text-center'><a class='btn btn-xs btn-danger btn-remove-logic'><span class='fa fa-trash'></span></a></td>";
                            tpl += "</tr>";
                            table.append(tpl);
                        }
                    });

                    if (objLogic != null) {
                        setDropDownValue(objLogic.IdLogic, objLogic.Name, objLogic.Description, objLogic.DateCreated, objLogic.IsDefault, updateDays);
                    }
                    
                },
                function (error)
                {
                    msg_warning("Error in get logics.");
                    $("#selectOptionDropDown").html("--Select--");
                }
            );
        }

        window.arrayToStringNumber = function(arrayBinary) {
            var chars = "";
            for (var i = 0; i < arrayBinary.length; i++) {
                chars += arrayBinary[i];
            }
            return chars;
        };

        window.stringToArrayNumber = function(stringCad) {
            var array = [];
            for (var i = 0; i < stringCad.length; i++) {
                array.push(stringCad.charAt(i));
            }
            return array;
        };

        window.convertDaysInvert = function(daysBinary) {
            var finalChar = "";
            for (var i = (daysBinary.length - 1) ; i >= 0; i--) {
                finalChar += daysBinary.charAt(i);
            }

            if (finalChar.length > 7) {
               finalChar = finalChar.substr(0, 7);
            } else {
                var length = 7 - finalChar.length;
                var tempChar = "";
                for (var j = 1; j <= length; j++) {
                    tempChar += "0";
                }
                finalChar = tempChar + "" + finalChar;
            }

            return finalChar;
        };

        window.convertDaysToSeven = function(daysString) {
            var finalChar = daysString;

            if (finalChar.length > 7) {
                finalChar = finalChar.substr(0, 7);
            } else {
                var length = 7 - finalChar.length;
                var tempChar = "";
                for (var j = 1; j <= length; j++) {
                    tempChar += "0";
                }
                finalChar = tempChar + "" + finalChar;
            }

            return finalChar;
        };

        window.getDaysShow = function(daysBinary) {
            var superFinal = "";
            for (var i = (daysBinary.length - 1) ; i >= 0; i--) {
                superFinal += daysBinary.charAt(i);
            }

            return superFinal;
        };
                
        window.setDayLogics = function(idLogic, name, description, date, daysBinary, dayName, position, e) {
            e.stopPropagation();
            var sender = e.srcElement || e.target;
            var className = dayName + "day";

            var item = $(sender);
            var items = $("." + className);

            if (item.hasClass("active")) return;

            for (var j = 0; j < items.length; j++) {
                $(items[j]).removeClass("active");
            }
            item.addClass("active");

            var arrayDays = [];
            for (var i = 0; i < daysBinary.length; i++) {
                var number = parseInt(daysBinary.charAt(i));

                if (parseInt(position) === i) {
                    number = (number === 1) ? 0 : 1;
                }

                arrayDays.push(number.toString());
            }

            var cadDays = arrayDays.join("");
            var stringCadDays = convertDaysInvert(cadDays);
            cadDays = convertDaysToSeven(stringCadDays);
            var digits = parseInt(cadDays, 2);


            Services.Local.UpdateLogic(idLogic, null, null, null, digits,
                    function (result) {
                        if (result == true) {
                            msg_success("dias guardados correctamente.");
                        }
                        else {
                            msg_error("No se actualizó los dias.");
                        }

                        var valor = $("#Type").val() * 1;
                        var virtualNumberValue = $("#virtualNumber").val();
                        loadLogicsUI(virtualNumberValue, valor, true);
                    },
                    function (error) {
                        msg_error("Error al actualizar los dias.");
                    }
            );
        }

        $("#contentDropDown").click(function (event)
        {
            event.stopPropagation();
            var elementContent = $("#contentDropDown");
            var elementValues = $("#dropDownContentValues");

            if (elementValues.css("display") == "none") {
                var offset = elementContent.offset();
                elementValues.css({ "left": offset.left, "top": offset.top + 46 });
                elementValues.fadeIn();
            }
            else {
                elementValues.fadeOut();
            }
        });

        $("#dropDownContentValues").click(function (evt) { evt.stopPropagation(); });
             
        $("#dropDownContentValues").on("click", "tbody tr", function (evt) {
            var idLogic = $(this).data("idlogic");
            var vx = logicsArray[idLogic];
            setDropDownValue(vx.IdLogic, vx.Name, vx.Description, vx.DateCreated);
        });

        $("#dropDownContentValues").on("click", ".btn-remove-logic", function (evt) {
            evt.preventDefault();
            evt.stopPropagation();
            var $tr = $(this).closest("tr");
            var idLogic = $tr.data("idlogic");
                    
            if (!confirm("Do you Confirm deletion of logic?")) {
                return;
            }

            Services.Local.DeleteLogic(idLogic,
                function () {
                    msg_success("Delete successfull");
                },
                function () {
                    msg_error("Error deleting logic.");
                });
        });

        $("#dropDownContentValues").on("click", "button", function (evt) {
            evt.stopPropagation();
                    
            var $btn = $(this);
            var $tClass = $btn.attr("toggle-class");
            if ($btn.hasClass($tClass)) {
                $btn.removeClass($tClass);
            }else{
                $btn.addClass($tClass);
            }
                    
            return false;
        });

        $(document).click(function () {
            $("#dropDownContentValues").fadeOut();
        });

        function FillTree(idLogic)
        {
            var object = logicsArray[idLogic];
                    
            if (object != null)
            {

                $("#loaderDropDown").removeClass("hidden");

                Services.Local.GetLogicXml(idLogic,
                    function (result) {
                        var xml;
                        $("#loaderDropDown").addClass("hidden");
                        if (result.indexOf('xml version=') > -1) {
                            xml = $.parseXML(result);
                        } else {
                            xml = $.parseXML('<?xml version="1.0" encoding="UTF-8"?>' + result);
                        }

                        imTreeUI1.loadXmlFromString(xml);
                    },
                    function(result) {
                        msg_warning("Error in get xml.");
                        $("#loaderDropDown").addClass("hidden");
                    }
                );
            }
            else{
                msg_error("Error in get xml");
            }

            $("#dropDownContentValues").slideUp();
        }

        function loadVirtualNumbers()
        {
            var virtualNumber = $("#virtualNumber");
            virtualNumbersArray = [];

            virtualNumber.html("");
            $("#virtualNumber").append("<option value='0'>-Loading-</option>");

            Services.Local.GetVirtualNumbers(
                function (result) {

                    if (result.length > 0) {
                        virtualNumber.html("");
                        $.each(result, function (i, v) {
                            virtualNumbersArray.push(new VirtualNumbers(v.Sid, v.Number));
                            virtualNumber.append("<option value='" + v.Sid + "'>" + v.Number + "</option>");
                        });
                    }

                    var options = $("#virtualNumber option");
                    options.eq(1).prop("selected", true);
                    if (options.length > 2) {
                        options.prop("disabled", false);
                    }
                            
                    //Tree created
                    var virtualNumberValue = $("#virtualNumber").val();
                    sidVirtualNumber = virtualNumberValue;
                    loadLogicsUI(sidVirtualNumber, 0);
                    imTreeUI1 = new IMTreeUI({ element: "jTreeUI1", virtualNumber: virtualNumberValue, lang: "en", type: (parseInt($("#Type").val()) === 1) ? "voice" : "sms" });
                    crearContextMenu('#jTreeUI1 .treeview ul.list-group li', imTreeUI1);
                    var domElement = imTreeUI1.getDOMElement();

                    domElement.addEventListener("jTreeUI:logicSaved", function (e) {
                        $("#Type").trigger("change");
                    }, false);

                },
                function (result) {
                    msg_warning("Error in get virtual numbers.");
                }
            );
        }


        $("#Type").change(function () {
            paginar(pagesGeneral);
            var valor = $("#Type").val() * 1;
            imTreeUI1.setIsVoice(valor == 1);
            loadLogicsUI(sidVirtualNumber, valor);
        });

        loadVirtualNumbers();

        $("#virtualNumber").change(function () {
            var selected = $("#virtualNumber").val();
            if(selected == "end"){
                        
            }
        });

        function pad(n, width, z) {
            z = z || '0';
            n = n + '';
            return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;
        }

        function dec2bin(dec) {
            return (dec >>> 0).toString(2);
        }

        function number2DecimalWeekdays(number) {
            var dNumber = dec2bin(number);
            return pad(dNumber, 7, 0);
        }

        CalculateMainHeight();
    });

</script>

    <link rel="stylesheet" href="js/contextMenu/jquery.contextMenu.css" />
    <script type="text/javascript" src="js/contextMenu/jquery.ui.position.min.js"></script>
    <script type="text/javascript" src="js/contextMenu/jquery.contextMenu.min.js"></script>

</body>
</html>
